name: é›¨äº‘è‡ªåŠ¨ç­¾åˆ°

on:
  # å®šæ—¶æ‰§è¡Œ - æ¯å¤©åŒ—äº¬æ—¶é—´ 8:00 å’Œ 20:00
  schedule:
    - cron: '0 0 * * *'   # UTC 00:00 = åŒ—äº¬æ—¶é—´ 08:00
    - cron: '0 12 * * *'  # UTC 12:00 = åŒ—äº¬æ—¶é—´ 20:00
  
  # æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:
  
  # æ¨é€åˆ°mainåˆ†æ”¯æ—¶è§¦å‘ï¼ˆç”¨äºæµ‹è¯•ï¼‰
  push:
    branches:
      - main
    paths:
      - 'main.py'
      - '.github/workflows/signin.yml'

jobs:
  signin:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        
      - name: ğŸ è®¾ç½® Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
          
      - name: ğŸŒ å®‰è£… Chrome
        uses: browser-actions/setup-chrome@v1
        with:
          chrome-version: stable
          
      - name: ğŸ“¦ å®‰è£…ä¾èµ–
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          
      - name: ğŸ” æ£€æŸ¥å¯†é’¥é…ç½®
        run: |
          if [ -z "${{ secrets.RAINYUN_USERNAME }}" ]; then
            echo "âŒ æœªé…ç½® RAINYUN_USERNAME"
            exit 1
          fi
          if [ -z "${{ secrets.RAINYUN_PASSWORD }}" ]; then
            echo "âŒ æœªé…ç½® RAINYUN_PASSWORD"
            exit 1
          fi
          echo "âœ… å¯†é’¥é…ç½®æ£€æŸ¥é€šè¿‡"
          
      - name: ğŸš€ æ‰§è¡Œç­¾åˆ°
        env:
          RAINYUN_USERNAME: ${{ secrets.RAINYUN_USERNAME }}
          RAINYUN_PASSWORD: ${{ secrets.RAINYUN_PASSWORD }}
        run: python main.py
        
      - name: ğŸ“¸ ä¸Šä¼ é”™è¯¯æˆªå›¾
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: error-screenshots
          path: "*.png"
          retention-days: 7
          
      - name: ğŸ“¢ å‘é€é€šçŸ¥ï¼ˆå¯é€‰ï¼‰
        if: always()
        run: |
          if [ "${{ job.status }}" == "success" ]; then
            echo "âœ… ç­¾åˆ°æˆåŠŸ"
          else
            echo "âŒ ç­¾åˆ°å¤±è´¥"
          fi